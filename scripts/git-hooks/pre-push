#!/bin/bash

# Git pre-push hook to check cargo fmt and clippy
# This hook will prevent pushing code that is not properly formatted or has clippy warnings

echo "Running code quality checks before push..."

# Check if cargo fmt would make any changes
echo "üîç Checking code formatting..."
if ! cargo fmt --check --quiet; then
    echo "‚ùå Code formatting check failed!"
    echo ""
    echo "Please run 'cargo fmt' to format your code before pushing."
    echo "You can also run 'cargo fmt --check' to see what needs formatting."
    echo ""
    echo "Push aborted."
    exit 1
fi
echo "‚úÖ Code formatting check passed!"

# Check clippy warnings
echo "üîç Checking clippy warnings..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "‚ùå Clippy check failed!"
    echo ""
    echo "Please fix all clippy warnings before pushing."
    echo "You can run 'cargo clippy --all-targets --all-features -- -D warnings' to see the issues."
    echo ""
    echo "Push aborted."
    exit 1
fi
echo "‚úÖ Clippy check passed!"

echo "üéâ All code quality checks passed! Ready to push."
exit 0
